import{S as ve,p as ce,r as S,s as K,a as L,n as H,i as X,b as he,t as _e,c as z,f as Le,d as Ue,e as de,g as q,h as ue,j as Qe,k as $e,l as fe,m as Ae,o as f,q as te,u as V,v as se,w as s,x as ze,y as Be,z as Ke,A as He,B as qe,C as B}from"./index-DrEcmgLD.js";import{F as Ve}from"./index-DeqFMdWb.js";import{u as We,F as pe}from"./index-BMjNTHV0.js";import{u as Ge,o as Je,c as Ye,a as Ze}from"./loader-D0vAg2Oo.js";import{L as Xe}from"./Loader-Dd-AuQXH.js";import{G as re}from"./iconBase-BkL14NmB.js";var et=class extends ve{constructor(e,t){super(),this.options=t,this.#s=e,this.#n=null,this.#o=ce(),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#r=void 0;#t=void 0;#i;#a;#o;#n;#m;#u;#f;#c;#h;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),me(this.#e,this.options)?this.#d():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ee(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ee(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#y(),this.#w(),this.#e.removeObserver(this)}setOptions(e){const t=this.options,r=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof S(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#j(),this.#e.setOptions(this.options),t._defaulted&&!K(this.options,t)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const a=this.hasListeners();a&&ge(this.#e,r,this.options,t)&&this.#d(),this.updateResult(),a&&(this.#e!==r||S(this.options.enabled,this.#e)!==S(t.enabled,this.#e)||L(this.options.staleTime,this.#e)!==L(t.staleTime,this.#e))&&this.#g();const o=this.#x();a&&(this.#e!==r||S(this.options.enabled,this.#e)!==S(t.enabled,this.#e)||o!==this.#l)&&this.#b(o)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),r=this.createResult(t,e);return st(this,r)&&(this.#t=r,this.#a=this.options,this.#i=this.#e.state),r}getCurrentResult(){return this.#t}trackResult(e,t){return new Proxy(e,{get:(r,a)=>(this.trackProp(a),t?.(a),a==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,a))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),r=this.#s.getQueryCache().build(this.#s,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.#d({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#d(e){this.#j();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(H)),t}#g(){this.#y();const e=L(this.options.staleTime,this.#e);if(X||this.#t.isStale||!he(e))return;const r=_e(this.#t.dataUpdatedAt,e)+1;this.#c=z.setTimeout(()=>{this.#t.isStale||this.updateResult()},r)}#x(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#b(e){this.#w(),this.#l=e,!(X||S(this.options.enabled,this.#e)===!1||!he(this.#l)||this.#l===0)&&(this.#h=z.setInterval(()=>{(this.options.refetchIntervalInBackground||Le.isFocused())&&this.#d()},this.#l))}#v(){this.#g(),this.#b(this.#x())}#y(){this.#c&&(z.clearTimeout(this.#c),this.#c=void 0)}#w(){this.#h&&(z.clearInterval(this.#h),this.#h=void 0)}createResult(e,t){const r=this.#e,a=this.options,o=this.#t,c=this.#i,l=this.#a,m=e!==r?e.state:this.#r,{state:d}=e;let n={...d},g=!1,h;if(t._optimisticResults){const p=this.hasListeners(),M=!p&&me(e,t),E=p&&ge(e,r,t,a);(M||E)&&(n={...n,...Ue(d.data,e.options)}),t._optimisticResults==="isRestoring"&&(n.fetchStatus="idle")}let{error:v,errorUpdatedAt:P,status:y}=n;h=n.data;let R=!1;if(t.placeholderData!==void 0&&h===void 0&&y==="pending"){let p;o?.isPlaceholderData&&t.placeholderData===l?.placeholderData?(p=o.data,R=!0):p=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,p!==void 0&&(y="success",h=de(o?.data,p,t),g=!0)}if(t.select&&h!==void 0&&!R)if(o&&h===c?.data&&t.select===this.#m)h=this.#u;else try{this.#m=t.select,h=t.select(h),h=de(o?.data,h,t),this.#u=h,this.#n=null}catch(p){this.#n=p}this.#n&&(v=this.#n,h=this.#u,P=Date.now(),y="error");const k=n.fetchStatus==="fetching",C=y==="pending",N=y==="error",w=C&&k,F=h!==void 0,x={status:y,fetchStatus:n.fetchStatus,isPending:C,isSuccess:y==="success",isError:N,isInitialLoading:w,isLoading:w,data:h,dataUpdatedAt:n.dataUpdatedAt,error:v,errorUpdatedAt:P,failureCount:n.fetchFailureCount,failureReason:n.fetchFailureReason,errorUpdateCount:n.errorUpdateCount,isFetched:n.dataUpdateCount>0||n.errorUpdateCount>0,isFetchedAfterMount:n.dataUpdateCount>m.dataUpdateCount||n.errorUpdateCount>m.errorUpdateCount,isFetching:k,isRefetching:k&&!C,isLoadingError:N&&!F,isPaused:n.fetchStatus==="paused",isPlaceholderData:g,isRefetchError:N&&F,isStale:ie(e,t),refetch:this.refetch,promise:this.#o,isEnabled:S(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const p=I=>{x.status==="error"?I.reject(x.error):x.data!==void 0&&I.resolve(x.data)},M=()=>{const I=this.#o=x.promise=ce();p(I)},E=this.#o;switch(E.status){case"pending":e.queryHash===r.queryHash&&p(E);break;case"fulfilled":(x.status==="error"||x.data!==E.value)&&M();break;case"rejected":(x.status!=="error"||x.error!==E.reason)&&M();break}}return x}updateResult(){const e=this.#t,t=this.createResult(this.#e,this.options);if(this.#i=this.#e.state,this.#a=this.options,this.#i.data!==void 0&&(this.#f=this.#e),K(t,e))return;this.#t=t;const r=()=>{if(!e)return!0;const{notifyOnChangeProps:a}=this.options,o=typeof a=="function"?a():a;if(o==="all"||!o&&!this.#p.size)return!0;const c=new Set(o??this.#p);return this.options.throwOnError&&c.add("error"),Object.keys(this.#t).some(l=>{const u=l;return this.#t[u]!==e[u]&&c.has(u)})};this.#S({listeners:r()})}#j(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#r=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#S(e){q.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function tt(e,t){return S(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function me(e,t){return tt(e,t)||e.state.data!==void 0&&ee(e,t,t.refetchOnMount)}function ee(e,t,r){if(S(t.enabled,e)!==!1&&L(t.staleTime,e)!=="static"){const a=typeof r=="function"?r(e):r;return a==="always"||a!==!1&&ie(e,t)}return!1}function ge(e,t,r,a){return(e!==t||S(a.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&ie(e,r)}function ie(e,t){return S(t.enabled,e)!==!1&&e.isStaleByTime(L(t.staleTime,e))}function st(e,t){return!K(e.getCurrentResult(),t)}var rt=class extends et{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:ue()})}getOptimisticResult(e){return e.behavior=ue(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){const{state:r}=e,a=super.createResult(e,t),{isFetching:o,isRefetching:c,isError:l,isRefetchError:u}=a,m=r.fetchMeta?.fetchMore?.direction,d=l&&m==="forward",n=o&&m==="forward",g=l&&m==="backward",h=o&&m==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:$e(t,r.data),hasPreviousPage:Qe(t,r.data),isFetchNextPageError:d,isFetchingNextPage:n,isFetchPreviousPageError:g,isFetchingPreviousPage:h,isRefetchError:u&&!d&&!g,isRefetching:c&&!n&&!h}}},it=class extends ve{#s;#e=void 0;#r;#t;constructor(e,t){super(),this.#s=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#s.defaultMutationOptions(e),K(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),t?.mutationKey&&this.options.mutationKey&&fe(t.mutationKey)!==fe(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#e}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#a()}mutate(e,t){return this.#t=t,this.#r?.removeObserver(this),this.#r=this.#s.getMutationCache().build(this.#s,this.options),this.#r.addObserver(this),this.#r.execute(e)}#i(){const e=this.#r?.state??Ae();this.#e={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){q.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#e.variables,r=this.#e.context,a={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#t.onSuccess?.(e.data,t,r,a)}catch(o){Promise.reject(o)}try{this.#t.onSettled?.(e.data,null,t,r,a)}catch(o){Promise.reject(o)}}else if(e?.type==="error"){try{this.#t.onError?.(e.error,t,r,a)}catch(o){Promise.reject(o)}try{this.#t.onSettled?.(void 0,e.error,t,r,a)}catch(o){Promise.reject(o)}}}this.listeners.forEach(t=>{t(this.#e)})})}},ye=f.createContext(!1),at=()=>f.useContext(ye);ye.Provider;function ot(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var nt=f.createContext(ot()),lt=()=>f.useContext(nt),ct=(e,t,r)=>{const a=r?.state.error&&typeof e.throwOnError=="function"?te(e.throwOnError,[r.state.error,r]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||a)&&(t.isReset()||(e.retryOnMount=!1))},ht=e=>{f.useEffect(()=>{e.clearReset()},[e])},dt=({result:e,errorResetBoundary:t,throwOnError:r,query:a,suspense:o})=>e.isError&&!t.isReset()&&!e.isFetching&&a&&(o&&e.data===void 0||te(r,[e.error,a])),ut=e=>{if(e.suspense){const r=o=>o==="static"?o:Math.max(o??1e3,1e3),a=e.staleTime;e.staleTime=typeof a=="function"?(...o)=>r(a(...o)):r(a),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},ft=(e,t)=>e.isLoading&&e.isFetching&&!t,pt=(e,t)=>e?.suspense&&t.isPending,xe=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function mt(e,t,r){const a=at(),o=lt(),c=V(),l=c.defaultQueryOptions(e);c.getDefaultOptions().queries?._experimental_beforeQuery?.(l);const u=c.getQueryCache().get(l.queryHash);l._optimisticResults=a?"isRestoring":"optimistic",ut(l),ct(l,o,u),ht(o);const m=!c.getQueryCache().get(l.queryHash),[d]=f.useState(()=>new t(c,l)),n=d.getOptimisticResult(l),g=!a&&e.subscribed!==!1;if(f.useSyncExternalStore(f.useCallback(h=>{const v=g?d.subscribe(q.batchCalls(h)):H;return d.updateResult(),v},[d,g]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),f.useEffect(()=>{d.setOptions(l)},[l,d]),pt(l,n))throw xe(l,d,o);if(dt({result:n,errorResetBoundary:o,throwOnError:l.throwOnError,query:u,suspense:l.suspense}))throw n.error;return c.getDefaultOptions().queries?._experimental_afterQuery?.(l,n),l.experimental_prefetchInRender&&!X&&ft(n,a)&&(m?xe(l,d,o):u?.promise)?.catch(H).finally(()=>{d.updateResult()}),l.notifyOnChangeProps?n:d.trackResult(n)}function _(e,t){const r=V(),[a]=f.useState(()=>new it(r,e));f.useEffect(()=>{a.setOptions(e)},[a,e]);const o=f.useSyncExternalStore(f.useCallback(l=>a.subscribe(q.batchCalls(l)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),c=f.useCallback((l,u)=>{a.mutate(l,u).catch(H)},[a]);if(o.error&&te(a.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:c,mutateAsync:o.mutate}}function gt(e,t){return mt(e,rt)}const T="https://to-do-app-kpx0.onrender.com";console.log("API_BASE_URL:",T);console.log("API BASE URL:",T);const xt=async({pageParam:e,userId:t})=>{const a=new URLSearchParams({limit:9});e!=null&&a.append("cursor",e);const o=await fetch(`${T}/api/v1/todo/user/${t}?${a.toString()}`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Failed to fetch todos");return o.json()},bt=async e=>{try{const t=await fetch(`${T}/api/v1/todo/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Failed to create todo: ${t.status}`);return await t.json()}catch(t){throw console.error("Error creating todo:",t),t}},vt=async(e,t)=>{try{console.log("SENDING TO BACKEND UPDATE ",e,t);const r=await fetch(`${T}/api/v1/todo/update/${e}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error(`Failed to update todo: ${r.status}`);return(await r.json()).data}catch(r){throw console.error("Error updating todo:",r),r}},yt=async({id:e})=>{try{const t=await fetch(`${T}/api/v1/todo/delete/${e}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to delete todo: ${t.status}`);return await t.json()}catch(t){throw console.error("Error deleting todo:",t),t}},wt=async({id:e})=>{try{const t=await fetch(`${T}/api/v1/todo/delete/${e}/clear-completed`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to delete todo: ${t.status}`);return await t.json()}catch(t){throw console.error("Error deleting many todo:",t),t}},jt=async e=>{try{const t=await fetch(`${T}/api/v1/todo/reorder`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const a=await t.text();throw new Error(`Failed to reorder todos: ${t.status} - ${a}`)}return await t.json()}catch(t){throw console.error("Error reordering todos:",t),t}};function St(e){return re({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"},child:[]}]})(e)}const Rt=({todo:e,onDelete:t,userId:r,onDragStart:a,onDragOver:o,onDrop:c,onDragEnd:l})=>{const u=V(),{theme:m}=se(),d=m==="dark",{mutate:n}=_({mutationKey:["update-todo"],mutationFn:({id:h,completed:v})=>vt(h,{completed:v}),onSuccess:(h,v)=>{const{id:P,completed:y}=v;u.setQueryData(["todos",r],R=>{if(!R)return R;const k=R.pages.map(C=>({...C,data:C.data.map(N=>N._id===P?{...N,completed:y}:N)}));return{...R,pages:k}})}}),g=()=>{n({id:e._id,completed:!e.completed})};return s.jsxs("li",{draggable:!0,onDragStart:a,onDrop:c,onDragOver:o,onDragEnd:l,className:"flex justify-between items-center px-4 py-2 border-b border-slate-700 cursor-grab",children:[s.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"peer sr-only",checked:e.completed,onChange:g}),s.jsx("div",{className:`
            w-6 h-6 rounded-full 
            border border-slate-400 
            flex items-center justify-center
            bg-slate-900 text-transparent
            peer-checked:bg-blue-500
            peer-checked:text-white
            peer-checked:border-slate-800
           ${d?"bg-slate-900":"bg-white border-slate-300 peer-checked:border-slate-400"}`,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",className:"peer-checked:block",children:s.jsx("path",{fill:"currentColor",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59L21 7Z"})})}),s.jsx("p",{className:`
            text-slate-200 transition
            peer-checked:line-through
            peer-checked:text-slate-500 ${d?"text-slate-200":"text-slate-950"}`,children:e.title})]}),s.jsx(St,{onClick:()=>t(e._id),className:"text-slate-500 hover:text-red-500 cursor-pointer"})]},e._id)},Ct="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='26'%20height='26'%3e%3cpath%20fill='%23FFF'%20fill-rule='evenodd'%20d='M13%2021a1%201%200%20011%201v3a1%201%200%2011-2%200v-3a1%201%200%20011-1zm-5.657-2.343a1%201%200%20010%201.414l-2.121%202.121a1%201%200%2001-1.414-1.414l2.12-2.121a1%201%200%20011.415%200zm12.728%200l2.121%202.121a1%201%200%2001-1.414%201.414l-2.121-2.12a1%201%200%20011.414-1.415zM13%208a5%205%200%20110%2010%205%205%200%20010-10zm12%204a1%201%200%20110%202h-3a1%201%200%20110-2h3zM4%2012a1%201%200%20110%202H1a1%201%200%20110-2h3zm18.192-8.192a1%201%200%20010%201.414l-2.12%202.121a1%201%200%2001-1.415-1.414l2.121-2.121a1%201%200%20011.414%200zm-16.97%200l2.121%202.12A1%201%200%20015.93%207.344L3.808%205.222a1%201%200%20011.414-1.414zM13%200a1%201%200%20011%201v3a1%201%200%2011-2%200V1a1%201%200%20011-1z'/%3e%3c/svg%3e",Nt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='26'%20height='26'%3e%3cpath%20fill='%23FFF'%20fill-rule='evenodd'%20d='M13%200c.81%200%201.603.074%202.373.216C10.593%201.199%207%205.43%207%2010.5%207%2016.299%2011.701%2021%2017.5%2021c2.996%200%205.7-1.255%207.613-3.268C23.22%2022.572%2018.51%2026%2013%2026%205.82%2026%200%2020.18%200%2013S5.82%200%2013%200z'/%3e%3c/svg%3e";function Ot(){const{theme:e,handleThemeChange:t}=se();return s.jsx("div",{children:s.jsx("button",{onClick:t,children:e==="light"?s.jsx("img",{className:"w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6",src:Nt,alt:"dark icon"}):s.jsx("img",{className:"w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6",src:Ct,alt:"light icon"})})})}const Et="/TO-DO-APP/assets/bg-desktop-light-BIdKokTn.jpg",Tt="/TO-DO-APP/assets/bg-desktop-dark-DzAvO98h.jpg";function Pt(e){return re({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z"},child:[]}]})(e)}function be(e){return re({attr:{viewBox:"0 0 1024 1024",fill:"currentColor",fillRule:"evenodd"},child:[{tag:"path",attr:{d:"M799.855 166.312c.023.007.043.018.084.059l57.69 57.69c.041.041.052.06.059.084a.118.118 0 0 1 0 .069c-.007.023-.018.042-.059.083L569.926 512l287.703 287.703c.041.04.052.06.059.083a.118.118 0 0 1 0 .07c-.007.022-.018.042-.059.083l-57.69 57.69c-.041.041-.06.052-.084.059a.118.118 0 0 1-.069 0c-.023-.007-.042-.018-.083-.059L512 569.926 224.297 857.629c-.04.041-.06.052-.083.059a.118.118 0 0 1-.07 0c-.022-.007-.042-.018-.083-.059l-57.69-57.69c-.041-.041-.052-.06-.059-.084a.118.118 0 0 1 0-.069c.007-.023.018-.042.059-.083L454.073 512 166.371 224.297c-.041-.04-.052-.06-.059-.083a.118.118 0 0 1 0-.07c.007-.022.018-.042.059-.083l57.69-57.69c.041-.041.06-.052.084-.059a.118.118 0 0 1 .069 0c.023.007.042.018.083.059L512 454.073l287.703-287.702c.04-.041.06-.052.083-.059a.118.118 0 0 1 .07 0Z"},child:[]}]})(e)}const kt=Ye({title:Ze().min(3).max(30).required("Title is required")}),Mt=`
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .todo-item-enter {
    animation: fadeInUp 0.3s ease-out forwards;
  }

  .todo-item {
    transition: all 0.2s ease-in-out;
  }

  .smooth-scroll {
    scroll-behavior: smooth;
  }
`,Qt=()=>{const{register:e,handleSubmit:t,formState:{errors:r,isSubmitting:a},reset:o}=Ge({resolver:Je(kt)}),{userData:c}=ze(i=>i.auth),{theme:l}=se(),u=l==="dark",m=Be(),d=Ke(),n=V(),[g]=We(),[h,v]=He(),[P,y]=f.useState(null),[R,k]=f.useState(!1),[C,N]=f.useState(!1),w=h.get("filter")||"all";console.log("Todo filter",w);const F=i=>{v({filter:i})},{data:U,status:x,error:p,isFetchingNextPage:M,fetchNextPage:E,hasNextPage:I}=gt({queryKey:["todos",c?.id],queryFn:({pageParam:i})=>xt({pageParam:i,userId:c?.id}),initialPageParam:null,getNextPageParam:i=>i.nextCursor??void 0,enabled:!!c?.id,refetchOnWindowFocus:!1,staleTime:300*1e3});console.log("todo data from React query tanstack: ",U);const Q=f.useMemo(()=>U?.pages?.flatMap(i=>i.data)??[],[U]),W=f.useMemo(()=>w==="active"?Q.filter(i=>!i.completed):w==="completed"?Q.filter(i=>i.completed):Q,[Q,w]),G=f.useRef(null),we=()=>{if(R||(k(!0),console.log("User has started scrolling")),!P||!G.current||!I||M)return;const i=G.current,b=P,D=i.getBoundingClientRect(),O=b.getBoundingClientRect();O.top>=D.top&&O.bottom<=D.bottom+200&&R&&(console.log("Loading next page..."),E())},{mutate:je}=_({mutationKey:["create-todo"],mutationFn:bt,onSuccess:i=>{console.log("Todo created successfully:",i),n.invalidateQueries({queryKey:["todos",c?.id],refetchType:"all"}),o()},onError:i=>console.error("Create todo failed:",i)}),Se=i=>{je({title:i.title}),console.log("Todo created with data:",i)},{mutate:Re}=_({mutationKey:["delete-todo"],mutationFn:yt,onSuccess:()=>{n.invalidateQueries({queryKey:["todos",c?.id],refetchType:"all"})},onError:i=>{console.error("Delete todo failed:",i),B.error("Impossible de supprimer la tÃ¢che.")}}),Ce=i=>{if(!i){console.error("Delete blocked: missing id");return}Re({id:i}),console.log("delete todo succesfully",i)},{mutate:Ne}=_({mutationKey:["delete-many"],mutationFn:wt,onSuccess:()=>{n.invalidateQueries({queryKey:["todos",c?.id],refetchType:"all"})},onError:i=>{console.error("Delete many todo failed:",i),B.error("Cannot delete many completed todo.")}}),Oe=i=>{if(!i){console.error("Delete blocked: missing id");return}Ne({id:i})},{mutate:Ee}=_({mutationFn:jt,onSuccess:()=>{n.invalidateQueries({queryKey:["todos",c?.id],refetchType:"all"})}}),Te={backgroundImage:`url(${u?Tt:Et})`,backgroundColor:"transparent",backgroundPosition:"top",backgroundRepeat:"no-repeat",backgroundSize:"auto center",width:"100%",height:"300px"},J=c?.firstName||"",Y=c?.lastName||"",ae=c?.email||"",Pe=`${J.charAt(0)||""}${Y.charAt(0)||""}`.toUpperCase();if(console.log("current userData",c),!c)return;const oe=async i=>{i.preventDefault();try{await g().unwrap(),m(qe()),d("/signin"),B.success("Successfully logged out!")}catch(b){console.error("Logout failed: ",b),B.error("Logout failed. Please try again.")}},ke=(i,b)=>{i.dataTransfer.setData("todoId",b),i.dataTransfer.effectAllowed="move",i.currentTarget.classList.add("opacity-50","border-b","border-slate-700")},Me=i=>{i.preventDefault()},Ie=(i,b)=>{i.preventDefault();const D=i.dataTransfer.getData("todoId");!D||D===b||n.setQueryData(["todos",c?.id],O=>{if(!O)return O;const $=O.pages.flatMap(j=>j.data),ne=$.findIndex(j=>j._id===D),le=$.findIndex(j=>j._id===b);if(ne===-1||le===-1)return O;const A=[...$],[Fe]=A.splice(ne,1);return A.splice(le,0,Fe),Ee({order:A.map((j,Z)=>({_id:j._id,order:Z}))}),{...O,pages:O.pages.map((j,Z)=>Z===0?{...j,data:A.slice(0,j.data.length)}:j)}})},De=i=>{i.currentTarget.classList.remove("opacity-50")};return x==="pending"?s.jsx(Xe,{}):p?s.jsx("div",{className:"w-full min-h-screen flex justify-center items-center bg-gray-950 dark:bg-gray-50 dark:text-white",children:s.jsx("p",{className:"text-white text-2xl",children:p.message})}):s.jsxs(s.Fragment,{children:[s.jsxs("style",{children:[" ",Mt," "]}),s.jsxs("div",{className:"w-full min-h-screen flex flex-col justify-center items-center",children:[s.jsx("div",{className:"w-full absolute inset-0 z-0",style:Te}),s.jsxs("div",{className:"content w-full h-auto lg:w-1/2 lg:min-h-[550px] z-10 mt-6 px-[8px] sm:px-[24px] lg:px-[0px]",children:[s.jsxs("div",{className:"header flex justify-between items-center",children:[s.jsx("h1",{className:"text-xl xs:text-2xl sm:text-3xl lg:text-4xl font-bold text-white",children:"TO DO"}),s.jsxs("div",{className:"flex justify-center items-center gap-4",children:[s.jsx(Ot,{}),s.jsxs("div",{className:"user_id hidden lg:block relative group",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-600 flex items-center justify-center text-white font-semibold cursor-pointer border border-slate-300 shadow-md",children:Pe}),s.jsx("div",{className:"absolute right-0 mt-1 w-56 bg-white rounded-xl shadow-xl p-4 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200",children:s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("p",{className:"text-gray-900 font-semibold text-xl",children:[J," ",Y]}),s.jsx("p",{className:"text-gray-500 text-sm mb-4",children:ae}),s.jsxs("button",{onClick:oe,className:"w-full flex items-center gap-2 py-2 px-3 rounded-lg bg-red-400 text-white text-sm font-medium hover:bg-red-500 transition",children:[s.jsx(pe,{}),"Sign out"]})]})})]}),s.jsx("div",{className:"mobile user_id lg:hidden",children:s.jsx("button",{onClick:()=>N(!C),className:"text-white text-2xl",children:C?s.jsx(be,{}):s.jsx(Pt,{})})})]})]}),s.jsx("div",{className:`to_do_form w-full h-12 mt-6 shadow-md rounded-md overflow-hidden
              ${u?"bg-slate-900":"bg-white"}
            `,children:s.jsxs("form",{onSubmit:t(Se),className:"w-full h-full flex flex-row justify-center items-center gap-0",children:[s.jsxs("div",{className:"flex-grow",children:[s.jsx("input",{type:"text",placeholder:"Type here and add to do",className:`bg-transparent text-current w-full h-full ring-0 outline-0 focus:outline-none focus:ring-0 px-[24px] placeholder:text-slate-700 ${u?"caret-white":"caret-black"}`,...e("title")}),r.title&&s.jsx("p",{className:"text-red-500 text-xs ml-2",children:r.title.message})]}),s.jsx("button",{type:"submit",disabled:a,className:"flex justify-center items-center px-[16px]",children:s.jsx(Ve,{className:"text-slate-700"})})]})}),s.jsxs("div",{ref:G,onScroll:we,className:`to_do_items_container w-full h-[420px] mt-6 overflow-y-auto relative rounded-md shadow-md flex flex-col smooth-scroll ${u?"bg-slate-900":"bg-white text-slate-950"}`,children:[W.length>0?s.jsxs("ul",{children:[W.map(i=>s.jsx(Rt,{todo:i,onDelete:Ce,userId:c?.id,onDragStart:b=>ke(b,i._id),onDrop:b=>Ie(b,i._id),onDragOver:Me,onDragEnd:De,style:{animationDelay:`${i%9*.05}s`}},i._id)),I&&s.jsx("li",{ref:y,className:"h-16 flex items-center justify-center text-slate-500 transition-all duration-300",children:M?s.jsxs("div",{className:"flex items-center gap-2 animate-pulse",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"text-sm",children:"Loading more..."})]}):s.jsx("span",{className:"text-sm opacity-60 hover:opacity-100 transition-opacity",children:"Scroll to load more"})})]}):s.jsxs("p",{className:"text-slate-600 text-center mt-4",children:["No ",w==="all"?"":w," todos"]}),s.jsxs("div",{className:`mt-auto border-t border-slate-600 bg-slate-900 sticky bottom-0 w-full flex justify-between items-center text-slate-600 px-4 py-2 ${u?"bg-slate-900":"bg-white text-slate-950"} `,children:[s.jsxs("div",{children:[W.length," Items"]}),s.jsx("div",{className:"hidden lg:flex gap-4",children:["all","active","completed"].map(i=>s.jsx("div",{className:`cursor-pointer ${w===i?"text-blue-400":""}`,onClick:()=>F(i),children:i.charAt(0).toUpperCase()+i.slice(1)},i))}),s.jsx("div",{onClick:Oe,className:"cursor-pointer",children:"Clear Completed"})]})]}),s.jsx("div",{className:`flex lg:hidden gap-4 rounded-md shadow-lg mt-4 justify-between items-center p-4
              ${u?"bg-slate-900":"bg-white text-slate-950"}
            `,children:["all","active","completed"].map(i=>s.jsx("div",{className:`cursor-pointer ${w===i?"text-blue-400":""}`,onClick:()=>F(i),children:i.charAt(0).toUpperCase()+i.slice(1)},i))}),s.jsxs("div",{className:`fixed top-0 right-0 h-full w-64 bg-slate-900 shadow-xl transform transition-transform duration-300 z-40
              ${C?"translate-x-0":"translate-x-full"}
            `,children:[s.jsx("button",{onClick:()=>N(!1),className:"absolute top-4 right-4 text-white text-xl",children:s.jsx(be,{})}),s.jsxs("div",{className:"h-full flex flex-col justify-between p-6 text-white",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("p",{className:"text-lg font-semibold",children:[J," ",Y]}),s.jsx("p",{className:"text-sm text-gray-300",children:ae})]}),s.jsxs("button",{onClick:oe,className:"flex items-center gap-2 py-2 px-3 rounded-lg bg-red-400 hover:bg-red-500 transition",children:[s.jsx(pe,{}),"Sign out"]})]})]})]}),s.jsx("div",{className:"Drag_and_drop_message flex justify-center items-center my-6",children:s.jsx("p",{className:"text-slate-600",children:"Drag and drop to reorder the list"})})]})]})};export{Qt as default};
